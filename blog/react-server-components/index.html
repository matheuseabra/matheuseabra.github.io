<!DOCTYPE html><html lang="en"><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title> Enter React Server Components | Matheus Seabra</title><meta name="description" content="FullStack JavaScript Development" /><meta itemprop="name" content="Matheus Seabra" /><meta name="author" content="Matheus Seabra" /><meta itemprop="description" content="An introduction to what React server components are and how this broadens React use cases." /><meta itemprop="image" content="https://my-image-hosting.s3.amazonaws.com/matheuseabra.me-blog/default-blog-image.png" /><meta property="og:url" content="https://matheuseabra.me/blog/react-server-components/" /><meta content="website" property="og:type" /><meta property="og:title" content="Enter React Server Components | Matheus Seabra" /><meta property="og:site_name" content="Matheus Seabra" /><meta property="og:description" content="An introduction to what React server components are and how this broadens React use cases." /><meta property="og:image" content="https://my-image-hosting.s3.amazonaws.com/matheuseabra.me-blog/default-blog-image.png" /><meta name="twitter:url" content="https://matheuseabra.me/blog/react-server-components/" /><meta content="summary" name="twitter:card" /><meta name="twitter:title" content="Enter React Server Components | Matheus Seabra" /><meta name="twitter:site" content="Matheus Seabra" /><meta name="twitter:description" content="An introduction to what React server components are and how this broadens React use cases." /><meta content="@matseabra" name="twitter:creator" /><meta property="twitter:image" content="https://my-image-hosting.s3.amazonaws.com/matheuseabra.me-blog/default-blog-image.png" /><meta name="twitter:image:width" content= "280" /><meta name="twitter:image:height" content= "480" /><link rel="icon" type="image/x-icon" href="/assets/images/fav.png" /><link rel="stylesheet" href="/assets/css/fonts.min.css" /><link rel="stylesheet" href="/assets/css/app.min.css" /><link rel="stylesheet" href="/assets/css/highlight.css" /><link rel="stylesheet" href="/assets/css/overides.css" /><link rel="alternate" type="application/rss+xml" title="Matheus Seabra" href="/feed.xml" /><link rel="canonical" href="/blog/react-server-components/" /> <script src="https://code.iconify.design/1/1.0.7/iconify.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script> <script> hljs.initHighlightingOnLoad(); </script></head><div id="barba-wrapper"><div class="barba-container enter-react-server-components"><header class="header"> <a class="header__title" href="/">Matheus Seabra</a><nav><ul class="header__list"><li> <a class="header__link" href="/" data-anchor="projects">Work</a></li><li> <a class="header__link" href="/blog">Blog</a></li><li> <a class="header__link" href="/about">About</a></li><li> <a class="header__link" href="/resume">Resume</a></li><li> <a class="header__link" data-scroll href="#contact">Contact</a></li></ul></nav></header><header class="header--mobile"> <a class="header__title" href="/">Matheus Seabra</a><div class="hamburger"><div></div><div></div><div></div></div><nav class="header__nav"><ul class="header__list"><li> <a class="header__link" href="/" data-anchor="projects">Work</a></li><li> <a class="header__link" href="/blog">Blog</a></li><li> <a class="header__link" href="/about">About</a></li><li> <a class="header__link" data-scroll href="#contact">Contact</a></li></ul></nav></header><main><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><section class="mast bg-lightgrey rellax" data-rellax-speed="-4"><div class="grid"><div class="mast__container" style="text-align: left;"><h1 class="mast__title" style="text-align: left; margin: 0">Enter React Server Components</h1><br> <time class="mast__date black-stripe" datetime="2020-12-25T00:00:00+00:00" itemprop="datePublished">December 2020</time></div></div></section><section class="section-padding bg-white"><div class="grid-post"><div id="markdown" itemprop="articleBody"><p>Recently, Dan and Lauren from the React team <a href="https://www.youtube.com/watch?v=TQQPAU21ZUw">made a talk</a> introducing a experimental feature from React called zero-bundle-size Server Components.</p><p>It‚Äôs a new (old) way to render React components but from a server-driven perspective.It‚Äôs not exactly SSR of components, and this can pontentially result in much smaller bundle-sizes.</p><p>Although it‚Äôs not quite ready for production yet, it‚Äôs worth to take a look at how it works and how it might be a good fit for certain use cases.</p><h2 id="current-ssr-has-limitations">Current SSR has limitations</h2><p>Today‚Äôs Server-side rendering of client-side JavaScript can be suboptimal. JavaScript for your components is rendered on the server into an HTML string. This HTML is delivered to the browser, which can appear to result in a fast First Contentful Paint or Largest Contentful Paint.</p><p>However, JavaScript still needs to be fetched for interactivity which is often achieved via a hydration step.</p><p>Server-side rendering is generally used for the initial page load, so post-hydration you‚Äôre unlikely to see it used again.</p><p>Now with Server Components, components can be refetched as they‚Äôre required. This limits the amount of code that needs to be send to the client.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MarkdownPreview.js: *before* Server Components</span>

<span class="k">import</span> <span class="nx">marked</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">marked</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// 35.9K (11.2K gzipped)</span>
<span class="k">import</span> <span class="nx">sanitizeHtml</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">sanitize-html</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// 206K (63.3K gzipped)</span>

<span class="kd">function</span> <span class="nx">MarkdownPreview</span><span class="p">({</span><span class="nx">text</span><span class="p">})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">sanitizeHtml</span><span class="p">(</span><span class="nx">marked</span><span class="p">(</span><span class="nx">text</span><span class="p">));</span>
  <span class="k">return</span> <span class="p">(</span><span class="cm">/* render */</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="enter-server-components">Enter Server Components</h2><p>React‚Äôs new Server Components compliment Server-side rendering, enabling rendering into an intermediate abstraction format without needing to add to the JavaScript bundle. This both allows merging the server-tree with the client-side tree without a loss of state and enables scaling up to more components.</p><p>Server Components are not a replacement for SSR. When paired together, they support quickly rendering in an intermediate format, then having Server-side rendering infrastructure rendering this into HTML enabling early paints to still be fast. We SSR the Client components which the Server components emit, similar to how SSR is used with other data-fetching mechanisms.</p><p>This time however, the JavaScript bundle will be significantly smaller. Early explorations have shown that bundle size wins could be significant (-18-29%), but the React team will have a clearer idea of wins in the wild once further infrastructure work is complete.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MarkdownPreview.server.js - Server Component === zero bundle size</span>

<span class="k">import</span> <span class="nx">marked</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">marked</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// zero bundle size</span>
<span class="k">import</span> <span class="nx">sanitizeHtml</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">sanitize-html</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// zero bundle size</span>

<span class="kd">function</span> <span class="nx">MarkdownPreview</span><span class="p">({</span> <span class="nx">text</span> <span class="p">})</span> <span class="p">{</span>
  <span class="c1">// same as before</span>
<span class="p">}</span>
</code></pre></div></div><h2 id="built-in-code-splitting">Built-in code-splitting</h2><p>It‚Äôs been considered a best-practice to only serve code users need as they need it by using code-splitting. This allows you to break your app down into smaller bundles requiring less code to be sent to the client. Prior to Server Components, one would manually use <code>React.lazy()</code> to define ‚Äúsplit-points‚Äù or rely on a heuristic set by a meta-framework, such as routes/pages to create new chunks.</p><div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Chart.js (before Server Components)</span>
<span class="k">import</span> <span class="nx">React</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// one of these will start loading * only when rendered on the client*:</span>
<span class="kd">const</span> <span class="nx">OldChartRenderer</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">lazy</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">"</span><span class="s2">./OldChartRenderer.js</span><span class="dl">"</span><span class="p">));</span>
<span class="kd">const</span> <span class="nx">NewChartRenderer</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">lazy</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">"</span><span class="s2">./NewChartRenderer.js</span><span class="dl">"</span><span class="p">));</span>

<span class="kd">function</span> <span class="nx">Chart</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">FeatureFlags</span><span class="p">.</span><span class="nx">useNewChartRenderer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">&lt;</span><span class="nc">NewChartRenderer</span> <span class="err">{</span><span class="p">...</span><span class="nt">props</span><span class="err">}</span> <span class="p">/&gt;;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">&lt;</span><span class="nc">OldChartRenderer</span> <span class="err">{</span><span class="p">...</span><span class="nt">props</span><span class="err">}</span> <span class="p">/&gt;;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><p>Some of the challenges with code-splitting are:</p><ul><li><p>Outside of a meta-framework (like Next.js), you often have to tackle this optimization manually, replacing import statements with dynamic imports.</p></li><li><p>It might delay when the application begins loading the component impacting the user-experience.</p></li></ul><p>Server Components introduce automatic code-splitting treating all normal imports in Client components as possible code-split points. They also allow developers to select which component to use much earlier (on the server), allowing the client to fetch it earlier in the rendering process.</p><h2 id="do-server-components-make-nextjs-ssr-obsolete">Do Server components make Next.js SSR obsolete?</h2><p>Short answer is no. They are quite different. Initial adoption of Server Components will actually be experimented with via meta-frameworks such as Next.js as research and experimentation continue.</p><p>To summarize a good explanation of the differences between Next.js SSR and Server Components from Dan Abramov:</p><ul><li><p>Code for Server Components is never delivered to the client. In many implementations of SSR using React, component code gets sent to the client via JavaScript bundles anyway. This can delay interactivity.</p></li><li><p>Server components enable access to the back-end from anywhere in the tree. When using Next.js, you‚Äôre used to accessing the back-end via <code class="language-plaintext highlighter-rouge">getServerProps()</code> which has the limitation of only working at the top-level page. Random npm components are unable to do this.</p></li><li><p>Server Components may be refetched while maintaining Client-side state inside of the tree. This is because the main transport mechanism is much richer than just HTML, allowing the refetching of a server-rendered part (e.g such as a search result list) without blowing away state inside (e.g search input text, focus, text selection)</p></li></ul><h2 id="conclusion">Conclusion</h2><p>What you should take away from Server Components:</p><p>In a typical app, tons of components only rerender when there‚Äôs new data. This will let you run those components on the server instead.</p><p>Thus, <strong>reducing bundle size by a lot.</strong></p><h2 id="relevant-reading">Relevant reading</h2><p>To learn more about this work, watch the talk from Dan and Lauren, read the RFC and do check out the Server Components demo to play around with this work. With thanks to Sebastian Markb√•ge, Lauren Tan, Joseph Savona and Dan Abramov for their work on Server Components.</p><ul><li><p><a href="https://twitter.com/sugarpirate_/status/1341141198258524163">Lauren and Dan‚Äôs talk</a></p></li><li><p><a href="https://addyosmani.com/blog/react-server-components/">Addy Osmani blog post</a></p></li><li><p><a href="https://github.com/reactjs/server-components-demo">Server components demo</a></p></li><li><p><a href="https://reactjs.org/blog/2020/12/21/data-fetching-with-react-server-components.html">Official React blog post</a></p></li></ul></div><div class="social-share black-stripe"> <b>Share on social media:</b><ul><li><a class="social-icon" href="https://twitter.com/intent/tweet?text=Enter React Server Components&url=https://matheuseabra.me/blog/react-server-components/&via=matseabra&related=matseabra" rel="nofollow" target="_blank" title="Share on Twitter"><span class="iconify" data-icon="mdi:twitter"></span></a></li><li> <a class="social-icon" href="https://facebook.com/sharer.php?u=https://matheuseabra.me/blog/react-server-components/" rel="nofollow" target="_blank" title="Share on Facebook"><span class="iconify" data-icon="mdi:facebook"></span></a></li><li> <a class="social-icon" href="http://www.linkedin.com/shareArticle?mini=true&url=https://matheuseabra.me&title=Matheus Seabra&summary=FullStack JavaScript Development&source=https://matheuseabra.me"><span class="iconify" data-icon="mdi:linkedin"></span></a></li><li> <a class="social-icon" href="http://www.reddit.com/submit?url=https://matheuseabra.me&title=Matheus Seabra"> <span class="iconify" data-icon="mdi:reddit"></span> </a></li></ul></div><style> .social-share { display: flex; flex-direction: column; align-items: flex-start; padding: 10px 20px; font-size: 1.2em; margin: 20px 0; } .social-share ul { display: inline-flex; list-style: none; margin-top: 10px; } .social-share li:first-child { margin-left: 0px; } .social-share li { margin-right: 10px; } .social-icon { color: white; }</style><div class="author-wrapper"><h3 class="black-stripe">About the author</h3><div class="author-container"> <img class="avatar-circle" src="/assets/images/matheus.jpg" alt=""><div class="author-description"><p>Matheus Seabra is a software engineer, writer, musician, and ex-failed-startup co-founder of CastleDev. He writes about software design and architecture best practices with FullStack JavaScript and is especially passionate about Domain-Driven Design, React and Enterprise Node.js with TypeScript.</p></div></div></div></div></section></article><section id="newsletter" class="work section-padding bg-lightgrey"><div class="grid newsletter-container"><h2 class="work__title black-stripe"> <span data-aos="slice-up" data-aos-duration="400">Subscribe to newsletter</span></h2><h3 class="newsletter-description"> Interested in how to write professional Full Stack JavaScript applications?<br>Subscribe to my newsletter to be notified of new content &#x1F525; <br> No spams. Unsubscribe anytime. üññ</h3><form action="https://matheuseabra.us7.list-manage.com/subscribe/post?u=0ada142f3d6af9716322c4b2e&amp;id=7901c8363c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate><div> <input type="email" value="" name="email" class="newsletter-input" id="mce-EMAIL" placeholder="Your best email" required> <button class="subscribe-button" type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe">Subscribe <span class="iconify" data-icon="feather:chevron-right" data-inline="false"></span></button></div><div id="mcs="response" id="mce-error-response" style="display:none"></div><div class="response" id="mce-success-response" style="display:none"></div><div style="display: none;" aria-hidden="true"> <input type="text" name="b_0ada142f3d6af9716322c4b2e_7901c8363c" tabindex="-1" value=""></div></form></div></section></main><footer id="contact" class="footer bg-black"><div class="grid"> <a class="footer__contact" href="/contact/">Let's connect</a><p style="color: white; margin: 20px 0 0 0;" class="footer__paragraph">Wow you‚Äôve come this far, send me an <a class="footer__link" href="mailto:matheusvieiracoelho@gmail.com">email</a> or let's chat on <a class="footer__link" href="http://twitter.com/matseabra" target="_blank">Twitter</a>.</p></div><ul class="footer__list"><li> <a class="icon-footer" href="https://matheuseabra.me/downloads/Matheus-Seabra-Resume.pdf" target="_blank"><span class="iconify" data-icon="mdi:file-document"></span></a></li><li> <a class="icon-footer" href="https://www.linkedin.com/in/matheus-seabra-080ab3b7/" target="_blank"><span class="iconify" data-icon="mdi:linkedin"></span></a></li><li> <a class="icon-footer" href="https://github.com/matheuseabra" target="_blank"><span class="iconify" data-icon="mdi:github"></span></a></li><li> <a class="icon-footer" href="http://twitter.com/matseabra" target="_blank"><span class="iconify" data-icon="mdi:twitter"></span></a></li></ul></footer></div></div><div class="transition transition-in"></div><script src="/assets/js/jquery.min.js"></script> <script src="/assets/js/app.min.js"></script></body></html>
  