<!DOCTYPE html><html lang="en"><meta charset="utf-8" /><meta content="IE=edge" http-equiv="X-UA-Compatible" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title> Processing large datasets in chunks with Node.js | Matheus Seabra</title><meta name="description" content="FullStack JavaScript Development" /><meta itemprop="name" content="Matheus Seabra" /><meta name="author" content="Matheus Seabra" /><meta itemprop="description" content="How to use the readline module in order to process large datasets in chunks and thus not blocking the main thread." /><meta itemprop="image" content="https://my-image-hosting.s3.amazonaws.com/matheuseabra.me-blog/default-blog-image.png" /><meta property="og:url" content="https://matheuseabra.me/blog/optimizing-processing-node-streams/" /><meta content="website" property="og:type" /><meta property="og:title" content="Processing large datasets in chunks with Node.js | Matheus Seabra" /><meta property="og:site_name" content="Matheus Seabra" /><meta property="og:description" content="How to use the readline module in order to process large datasets in chunks and thus not blocking the main thread." /><meta property="og:image" content="https://my-image-hosting.s3.amazonaws.com/matheuseabra.me-blog/default-blog-image.png" /><meta name="twitter:url" content="https://matheuseabra.me/blog/optimizing-processing-node-streams/" /><meta content="summary" name="twitter:card" /><meta name="twitter:title" content="Processing large datasets in chunks with Node.js | Matheus Seabra" /><meta name="twitter:site" content="Matheus Seabra" /><meta name="twitter:description" content="How to use the readline module in order to process large datasets in chunks and thus not blocking the main thread." /><meta content="@matseabra" name="twitter:creator" /><meta property="twitter:image" content="https://my-image-hosting.s3.amazonaws.com/matheuseabra.me-blog/default-blog-image.png" /><meta name="twitter:image:width" content= "280" /><meta name="twitter:image:height" content= "480" /><link rel="icon" type="image/x-icon" href="/assets/images/fav.png" /><link rel="stylesheet" href="/assets/css/fonts.min.css" /><link rel="stylesheet" href="/assets/css/app.min.css" /><link rel="stylesheet" href="/assets/css/highlight.css" /><link rel="stylesheet" href="/assets/css/overides.css" /><link rel="alternate" type="application/rss+xml" title="Matheus Seabra" href="/feed.xml" /><link rel="canonical" href="/blog/optimizing-processing-node-streams/" /> <script src="https://code.iconify.design/1/1.0.7/iconify.min.js"></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script> <script> hljs.initHighlightingOnLoad(); </script></head><div id="barba-wrapper"><div class="barba-container processing-large-datasets-in-chunks-with-node-js"><header class="header"> <a class="header__title" href="/">Matheus Seabra</a><nav><ul class="header__list"><li> <a class="header__link" href="/" data-anchor="projects">Work</a></li><li> <a class="header__link" href="/blog">Blog</a></li><li> <a class="header__link" href="/about">About</a></li><li> <a class="header__link" href="/resume">Resume</a></li><li> <a class="header__link" data-scroll href="#contact">Contact</a></li></ul></nav></header><header class="header--mobile"> <a class="header__title" href="/">Matheus Seabra</a><div class="hamburger"><div></div><div></div><div></div></div><nav class="header__nav"><ul class="header__list"><li> <a class="header__link" href="/" data-anchor="projects">Work</a></li><li> <a class="header__link" href="/blog">Blog</a></li><li> <a class="header__link" href="/about">About</a></li><li> <a class="header__link" data-scroll href="#contact">Contact</a></li></ul></nav></header><main><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><section class="mast bg-lightgrey rellax" data-rellax-speed="-4"><div class="grid"><div class="mast__container" style="text-align: left;"><h1 class="mast__title" style="text-align: left; margin: 0">Processing large datasets in chunks with Node.js</h1><br> <time class="mast__date black-stripe" datetime="2021-01-03T00:00:00+00:00" itemprop="datePublished">January 2021</time></div></div></section><section class="section-padding bg-white"><div class="grid-post"><div id="markdown" itemprop="articleBody"><p>One use case I generally see is reading the contents of files. With Node that is usually done with the method <code class="language-plaintext highlighter-rouge">fs.readFile()</code> from the <code class="language-plaintext highlighter-rouge">fs</code> native module.</p><p>To read a small file, it‚Äôs okay to use the approach below:</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="dl">"</span><span class="s2">./small-text.txt</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">utf-8</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">contents</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">contents</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div><p>Then you should be able to read this small file content. However, for larger file sizes, you would encounter an error with the buffer. Such as <code class="language-plaintext highlighter-rouge">RangeError: Attempt to allocate Buffer larger than maximum size.</code></p><p><strong>Solution:</strong> In order to read the large files, you can import the <code class="language-plaintext highlighter-rouge">readline</code> native module.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">fs</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">readline</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">readline</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">lineReader</span> <span class="o">=</span> <span class="nx">readline</span><span class="p">.</span><span class="nx">createInterface</span><span class="p">({</span>
  <span class="na">input</span><span class="p">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="dl">"</span><span class="s2">path/largeFile.csv</span><span class="dl">"</span><span class="p">),</span>
  <span class="na">output</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">,</span>
  <span class="na">terminal</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">});</span>

<span class="nx">lineReader</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">line</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">line</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">line</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">lineReader</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">pause</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Done processing the file!</span><span class="dl">"</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div><p>As described in the <a href="https://nodejs.org/api/readline.html">node documentation</a>:</p><blockquote><p>‚ÄúThe readline module provides an interface for reading data from a Readable stream one line at a time.‚Äù</p></blockquote><p><strong>Note:</strong> the Node.js application will not terminate until the readline.Interface is closed because the interface waits for data to be received on the input stream.</p><p>Replace the file path with your path to the large file to process. You can process the file line by line inside the <code class="language-plaintext highlighter-rouge">.on('line')</code> event, such as parsing to JSON and increment the counter. The final sum can be displayed at the <code class="language-plaintext highlighter-rouge">.on('pause')</code> event after finish reading the file.</p><p>Now you should be able to process massive datasets! üî•</p></div><div class="social-share black-stripe"> <b>Share on social media:</b><ul><li><a class="social-icon" href="https://twitter.com/intent/tweet?text=Processing large datasets in chunks with Node.js&url=https://matheuseabra.me/blog/optimizing-processing-node-streams/&via=matseabra&related=matseabra" rel="nofollow" target="_blank" title="Share on Twitter"><span class="iconify" data-icon="mdi:twitter"></span></a></li><li> <a class="social-icon" href="https://facebook.com/sharer.php?u=https://matheuseabra.me/blog/optimizing-processing-node-streams/" rel="nofollow" target="_blank" title="Share on Facebook"><span class="iconify" data-icon="mdi:facebook"></span></a></li><li> <a class="social-icon" href="http://www.linkedin.com/shareArticle?mini=true&url=https://matheuseabra.me&title=Matheus Seabra&summary=FullStack JavaScript Development&source=https://matheuseabra.me"><span class="iconify" data-icon="mdi:linkedin"></span></a></li><li> <a class="social-icon" href="http://www.reddit.com/submit?url=https://matheuseabra.me&title=Matheus Seabra"> <span class="iconify" data-icon="mdi:reddit"></span> </a></li></ul></div><style> .social-share { display: flex; flex-direction: column; align-items: flex-start; padding: 10px 20px; font-size: 1.2em; margin: 20px 0; } .social-share ul { display: inline-flex; list-style: none; margin-top: 10px; } .social-share li:first-child { margin-left: 0px; } .social-share li { margin-right: 10px; } .social-icon { color: white; }</style><div class="author-wrapper"><h3 class="black-stripe">About the author</h3><div class="author-container"> <img class="avatar-circle" src="/assets/images/matheus.jpg" alt=""><div class="author-description"><p>Matheus Seabra is a software engineer, writer, musician, and ex-failed-startup co-founder of CastleDev. He writes about software design and architecture best practices with FullStack JavaScript and is especially passionate about Domain-Driven Design, React and Enterprise Node.js with TypeScript.</p></div></div></div></div></section></article><section id="newsletter" class="work section-padding bg-lightgrey"><div class="grid newsletter-container"><h2 class="work__title black-stripe"> <span data-aos="slice-up" data-aos-duration="400">Subscribe to newsletter</span></h2><h3 class="newsletter-description"> Interested in how to write professional Full Stack JavaScript applications?<br>Subscribe to my newsletter to be notified of new content &#x1F525; <br> No spams. Unsubscribe anytime. üññ</h3><form action="https://matheuseabra.us7.list-manage.com/subscribe/post?u=0ada142f3d6af9716322c4b2e&amp;id=7901c8363c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate><div> <input type="email" value="" name="email" class="newsletter-input" id="mce-EMAIL" placeholder="Your best email" required> <button class="subscribe-button" type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe">Subscribe <span class="iconify" data-icon="feather:chevron-right" data-inline="false"></span></button></div><div id="mcs="response" id="mce-error-response" style="display:none"></div><div class="response" id="mce-success-response" style="display:none"></div><div style="display: none;" aria-hidden="true"> <input type="text" name="b_0ada142f3d6af9716322c4b2e_7901c8363c" tabindex="-1" value=""></div></form></div></section></main><footer id="contact" class="footer bg-black"><div class="grid"> <a class="footer__contact" href="/contact/">Let's connect</a><p style="color: white; margin: 20px 0 0 0;" class="footer__paragraph">Wow you‚Äôve come this far, send me an <a class="footer__link" href="mailto:matheusvieiracoelho@gmail.com">email</a> or let's chat on <a class="footer__link" href="http://twitter.com/matseabra" target="_blank">Twitter</a>.</p></div><ul class="footer__list"><li> <a class="icon-footer" href="https://matheuseabra.me/downloads/Matheus-Seabra-Resume.pdf" target="_blank"><span class="iconify" data-icon="mdi:file-document"></span></a></li><li> <a class="icon-footer" href="https://www.linkedin.com/in/matheus-seabra-080ab3b7/" target="_blank"><span class="iconify" data-icon="mdi:linkedin"></span></a></li><li> <a class="icon-footer" href="https://github.com/matheuseabra" target="_blank"><span class="iconify" data-icon="mdi:github"></span></a></li><li> <a class="icon-footer" href="http://twitter.com/matseabra" target="_blank"><span class="iconify" data-icon="mdi:twitter"></span></a></li></ul></footer></div></div><div class="transition transition-in"></div><script src="/assets/js/jquery.min.js"></script> <script src="/assets/js/app.min.js"></script></body></html>
  